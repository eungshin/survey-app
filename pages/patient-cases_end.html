<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전문가 설문 시스템 - 환자 케이스</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Pretendard:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
</head>

<body>
    <div class="app-container large" style="position: relative;">
        <!-- Global Header Icons -->
        <div class="global-header-icons">
            <button class="header-icon-btn" onclick="showMypageModal()">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <circle cx="16" cy="11" r="5" stroke="#666" stroke-width="2" />
                    <path d="M6 26C6 20.4772 10.4772 16 16 16C21.5228 16 26 20.4772 26 26" stroke="#666"
                        stroke-width="2" />
                </svg>
            </button>
            <button class="header-icon-btn" onclick="showExitModal()">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <path d="M8 8L24 24M8 24L24 8" stroke="#666" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
        </div>

        <!-- MyPage Confirmation Modal -->
        <div class="modal-overlay" id="mypageModal">
            <div class="modal">
                <p class="modal-description" style="text-align: center; margin-bottom: 24px; font-size: 18px;">
                    설문 조사를 중단하고 마이페이지로 이동하시겠습니까?
                </p>
                <div class="modal-actions" style="display: flex; justify-content: center; gap: 12px;">
                    <button class="btn btn-outline-primary" style="min-width: 100px;" onclick="goToMypage()">예</button>
                    <button class="btn btn-outline-primary" style="min-width: 100px; border-color: #ccc; color: #666;"
                        onclick="closeMypageModal()">아니요</button>
                </div>
            </div>
        </div>

        <!-- Exit Confirmation Modal -->
        <div class="modal-overlay" id="exitModal">
            <div class="modal">
                <p class="modal-description" style="text-align: center; margin-bottom: 24px; font-size: 18px;">
                    설문을 끝내고 메타 세미나 공간으로 이동하시겠습니까?
                </p>
                <div class="modal-actions" style="display: flex; justify-content: center; gap: 12px;">
                    <button class="btn btn-outline-primary" style="min-width: 100px;" onclick="exitPage()">예</button>
                    <button class="btn btn-outline-primary" style="min-width: 100px; border-color: #ccc; color: #666;"
                        onclick="closeExitModal()">아니요</button>
                </div>
            </div>
        </div>

        <!-- ========== Page 4: Patient Cases ========== -->
        <section class="page-section">
            <div class="patient-cases-wrapper">
                <!-- White Card with everything inside -->
                <div class="card patient-cases-card">
                    <h1 class="page-title">에소메프라졸 병용 환자 케이스 설문</h1>

                    <div class="case-count-wrapper">
                        <div class="case-count">
                            <span class="count-label">등록된 케이스 :</span>
                            <span class="count-value">2 / 10</span>
                        </div>
                    </div>

                    <!-- Solid grey separator line -->
                    <div style="border-bottom: 2px solid #777777; margin-bottom: 20px;"></div>

                    <div class="patient-cases-list">
                        <div class="patient-case-item" style="border-bottom: 1px dashed #ccc; padding-bottom: 16px;">
                            <div class="case-info">
                                <h3 class="case-name">환자 케이스 01 (PJ01234)</h3>
                                <span class="case-status in-progress">작성중</span>
                            </div>
                            <button class="btn btn-outline-primary"
                                onclick="location.href='patient-cases.html'">수정하기</button>
                        </div>

                        <div class="patient-case-item" style="border-bottom: 1px dashed #ccc; padding-bottom: 16px;">
                            <div class="case-info">
                                <h3 class="case-name">환자 케이스 02 (PJ02234)</h3>
                                <span class="case-status in-progress">작성중</span>
                            </div>
                            <button class="btn btn-outline-primary"
                                onclick="location.href='patient-cases.html'">참여하기</button>
                        </div>

                        <div class="patient-case-item" style="border-bottom: 1px dashed #ccc; padding-bottom: 16px;">
                            <div class="case-info">
                                <h3 class="case-name">환자 케이스 03 (PJ03234)</h3>
                                <span class="case-status completed">완료</span>
                            </div>
                            <button class="btn btn-outline-primary"
                                onclick="location.href='patient-cases.html'">수정하기</button>
                        </div>

                        <div class="patient-case-item" style="border-bottom: 1px dashed #ccc; padding-bottom: 16px;">
                            <div class="case-info">
                                <h3 class="case-name">환자 케이스 04 (PJ04234)</h3>
                                <span class="case-status in-progress">작성중</span>
                            </div>
                            <button class="btn btn-outline-primary"
                                onclick="location.href='patient-cases.html'">수정하기</button>
                        </div>

                        <div class="patient-case-item" style="border-bottom: 1px dashed #ccc; padding-bottom: 16px;">
                            <div class="case-info">
                                <h3 class="case-name">환자 케이스 05 (PJ05234)</h3>
                                <span class="case-status in-progress">작성중</span>
                            </div>
                            <button class="btn btn-outline-primary"
                                onclick="location.href='patient-cases.html'">수정하기</button>
                        </div>
                    </div>

                    <div class="add-case-section">
                        <span class="add-case-label">새 환자 케이스 추가</span>
                        <button class="btn-add-case" onclick="addNewCase()">
                            <svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                                <path d="M15 6V24M6 15H24" stroke="#3196FB" stroke-width="3" stroke-linecap="round" />
                            </svg>
                        </button>
                    </div>

                    <button class="btn-submit-final" id="submitBtn" onclick="submitSurvey()">
                        설문 최종 제출
                    </button>

                    <p class="submit-notice">
                        모든 환자 케이스 설문이 완료된 후 제출이 활성화 됩니다. 최종 제출 후에는 설문 내용을 수정하실 수 없습니다.
                    </p>
                </div>
            </div>
        </section>

        <!-- Final Submit Modal (Confirmation) -->
        <div class="modal-overlay" id="finalSubmitModal">
            <div class="modal">
                <h2 class="modal-title" style="text-align: center;">설문을 최종 제출하시겠습니까?</h2>

                <p class="modal-description" style="text-align: center; margin-bottom: 24px;">
                    제출 후에는 수정하실 수 없습니다<br>
                    제출하시겠습니까?
                </p>

                <div class="modal-actions" style="display: flex; justify-content: center; gap: 12px;">
                    <button class="btn btn-outline-primary" style="min-width: 100px;"
                        onclick="submitSurveyConfirm()">예</button>
                    <button class="btn btn-outline-primary" style="min-width: 100px; border-color: #ccc; color: #666;"
                        onclick="closeModal()">아니요</button>
                </div>
            </div>
        </div>

        <!-- Success Modal (Post-Submit) -->
        <div class="modal-overlay" id="successModal">
            <div class="modal">
                <h2 class="modal-title" style="text-align: center;">제출 완료</h2>

                <p class="modal-description" style="text-align: center; margin-bottom: 24px;">
                    최종 제출이 되었습니다!<br>
                    다른 설문을 계속하시겠습니까?
                </p>

                <div class="modal-actions" style="display: flex; justify-content: center; gap: 12px;">
                    <button class="btn btn-outline-primary" style="min-width: 100px;"
                        onclick="handleSuccessYes()">예</button>
                    <button class="btn btn-outline-primary" style="min-width: 100px; border-color: #ccc; color: #666;"
                        onclick="handleSuccessExit()">나가기</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add New Case
        function addNewCase() {
            // Redirect to patient-cases.html (Step 4) directly
            location.href = 'patient-cases.html';
        }

        // Note: "Edit" and "Participate" buttons have onclick handlers set inline in HTML

        // Submit Survey - Open Modal
        function submitSurvey() {
            document.getElementById('finalSubmitModal').classList.add('active');
        }

        // Close Confirmation Modal (Stay on page)
        function closeModal() {
            document.getElementById('finalSubmitModal').classList.remove('active');
        }

        // Confirm Submit - Close Confim Modal, Open Success Modal
        function submitSurveyConfirm() {
            sessionStorage.clear(); // Optional: clear session
            document.getElementById('finalSubmitModal').classList.remove('active');
            document.getElementById('successModal').classList.add('active');
        }

        // Success Modal: "Yes" -> Go to Intro
        function handleSuccessYes() {
            location.href = 'survey-intro.html';
        }

        // Success Modal: "Exit" -> Close Window and Redirect to Index as fallback
        function handleSuccessExit() {
            // Try closing window
            window.open('', '_self', '');
            window.close();

            // Fallback if window.close() is blocked
            setTimeout(() => {
                location.href = 'index.html';
            }, 100);
        }

        // ========== Header Icon Modal Functions ==========
        // MyPage Modal
        function showMypageModal() {
            document.getElementById('mypageModal').classList.add('active');
        }
        function closeMypageModal() {
            document.getElementById('mypageModal').classList.remove('active');
        }
        function goToMypage() {
            location.href = 'mypage.html';
        }

        // Exit Modal
        function showExitModal() {
            document.getElementById('exitModal').classList.add('active');
        }
        function closeExitModal() {
            document.getElementById('exitModal').classList.remove('active');
        }
        function exitPage() {
            window.open('', '_self', '');
            window.close();
            setTimeout(() => {
                location.href = 'index.html';
            }, 100);
        }
    </script>

</body>

</html>